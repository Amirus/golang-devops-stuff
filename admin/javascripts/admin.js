!function(){var e;e=angular.module("adminApp",[]),e.controller("AdminIndexCtrl",["$scope","$location","$q",function(e,t,n){var a;return e.host=t.search().host||t.host(),e.port=t.search().port||("sandbox.influxdb.org"===e.host?9061:8086),e.database=t.search().database,e.username=t.search().username,e.password=t.search().password,e.authenticated=!1,e.isClusterAdmin=!1,e.isDatabaseAdmin=!1,e.databases=[],e.admins=[],e.data=[],e.readQuery=null,e.writeSeriesName=null,e.writeValues=null,e.successMessage="OK",e.alertMessage="Error",e.authMessage="",e.selectedPane="databases",e.newDbUser={},e.newAdminUsername=null,e.newAdminPassword=null,a=null,e.authenticateAsClusterAdmin=function(){return a=new InfluxDB(e.host,e.port,e.username,e.password),n.when(a.authenticateClusterAdmin()).then(function(){return e.authenticated=!0,e.isClusterAdmin=!0,e.isDatabaseAdmin=!1,e.getDatabases(),e.getClusterAdmins(),e.selectedPane="databases",t.search({})},function(t){return e.authError(t.responseText)})},e.authenticateAsDatabaseAdmin=function(){return a=new InfluxDB(e.host,e.port,e.username,e.password,e.database),n.when(a.authenticateDatabaseAdmin(e.database)).then(function(){return e.authenticated=!0,e.isDatabaseAdmin=!0,e.isClusterAdmin=!1,e.selectedPane="data",t.search({})},function(t){return e.authError(t.responseText)})},e.getDatabases=function(){return n.when(a.getDatabases()).then(function(t){return e.databases=JSON.parse(t)})},e.getClusterAdmins=function(){return n.when(a.getClusterAdmins()).then(function(t){return e.admins=JSON.parse(t)})},e.createClusterAdmin=function(){return n.when(a.createClusterAdmin(e.newAdminUsername,e.newAdminPassword)).then(function(){return e.newAdminUsername=null,e.newAdminPassword=null,e.getClusterAdmins()})},e.createDatabase=function(){return n.when(a.createDatabase(e.newDatabaseName)).then(function(){return e.newDatabaseName=null,e.getDatabases()})},e.createDatabaseUser=function(){return n.when(a.createUser(e.newDbUser.database,e.newDbUser.username,e.newDbUser.password)).then(function(){return e.newDbUser={},e.getDatabases()})},e.deleteDatabase=function(t){return n.when(a.deleteDatabase(t)).then(function(){return e.getDatabases()})},e.writeData=function(){var t;if(!e.writeSeriesName)return e.error("Time Series Name is required."),void 0;try{t=JSON.parse(e.writeValues)}catch(r){return e.alertMessage="Unable to parse JSON.",$("span#writeFailure").show().delay(1500).fadeOut(500),void 0}return n.when(a.writePoint(e.writeSeriesName,t)).then(function(){return e.success("200 OK")})},e.readData=function(){return e.data=[],n.when(a._readPoint(e.readQuery)).then(function(t){var n;return n=JSON.parse(t),n.forEach(function(t){return e.data.push({name:t.name,columns:t.columns,points:t.points,graphs:e.filteredColumns(t).map(function(n){return e.columnPoints(t,n)})})})})},e.authError=function(t){return e.authMessage=t,$("span#authFailure").show().delay(1500).fadeOut(500)},e.error=function(t){return e.alertMessage=t,$("span#writeFailure").show().delay(1500).fadeOut(500)},e.success=function(t){return e.successMessage=t,$("span#writeSuccess").show().delay(1500).fadeOut(500)},e.filteredColumns=function(e){return e.columns.filter(function(e){return"time"!==e&&"sequence_number"!==e})},e.columnPoints=function(e,t){var n;return n=e.columns.indexOf(t),e.points.map(function(e){return{time:new Date(e[0]),value:e[n]}})},e.username&&e.password&&e.database?e.authenticate():void 0}]),e.directive("lineChart",[function(){return{restrict:"E",replace:!1,scope:{data:"=data"},link:function(e,t,n){var a,r,s;return console.log(e.data),s=parseInt(n.margin)||20,a=parseInt(n.barHeight)||20,r=parseInt(n.barPadding)||5,e.render=function(e){var n,a,r,u,i,o,d,c;return console.log(e),e?(s={top:0,right:0,bottom:30,left:50},u=1086-s.left-s.right,n=200-s.top-s.bottom,i=d3.time.scale().range([0,u]),d=d3.scale.linear().range([n,0]),o=d3.svg.axis().scale(i).orient("bottom"),c=d3.svg.axis().scale(d).orient("left").ticks(5),a=d3.svg.line().x(function(e){return i(e.time)}).y(function(e){return d(e.value)}),r=d3.select(t[0]).append("svg").attr("width",u+s.left+s.right).attr("height",n+s.top+s.bottom).append("g").attr("transform","translate("+s.left+","+s.top+")"),i.domain(d3.extent(e,function(e){return e.time})),d.domain(d3.extent(e,function(e){return e.value})),r.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(o),r.append("g").attr("class","y axis").call(c),r.append("path").datum(e).attr("class","line").attr("d",a),r.append("text").text("FOOOOO")):void 0},e.render(e.data)}}}])}.call(this);